{% extends 'base.html' %}
{% load static %}
{% load products_tags %}

{% block content %}
{% show_all_tags %}
<div class="banner" style="background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('{% static 'core/images/banner.jpg' %}');">
  <div class="banner-content">
    <h1>–õ–∞–≤–∫–∞ —Ä–µ–¥–∫–æ—Å—Ç–µ–π</h1>
    <p>–ú–∞–≥–∞–∑–∏–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä—É—á–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π –∏ –≤–∏–Ω—Ç–∞–∂–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤. –ü–æ–¥–∞—Ä–∫–∏, —É–∫—Ä–∞—à–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–º–µ—Ç—ã –∏—Å–∫—É—Å—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–Ω–µ—Å—É—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —Å—Ç–∞—Ä–∏–Ω—ã –∏ —É—é—Ç–∞ –≤ –≤–∞—à –¥–æ–º.</p>
  </div>
</div>

<div class="container">
  <div class="grid">
    {% for p in products %}
      {% if p.is_published %}
        <div class="card">
          <div class="image-container">
            <img src="{{ p.image.url }}" alt="{{ p.title }}">
            <form method="post" action="{% url 'add_to_favorites' p.slug %}">
              {% csrf_token %}
              {% if user.is_authenticated and perms.products.can_mark_featured %}
                {% if user in p.favorites.all %}
                  <button type="submit" class="favorite-btn" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
                          formaction="{% url 'remove_from_favorites' p.slug %}">‚ù§Ô∏è</button>
                {% else %}
                  <button type="submit" class="favorite-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">ü§ç</button>
                {% endif %}
              {% endif %}
            </form>
          </div>
          <div class="card-body">
            <div class="card-content">
              <h5 class="card-title">{{ p.title }}</h5>
              <p class="product-price">{{ p.price }} ‚ÇΩ</p>
              <div class="card-text">
                {% autoescape off %}
                {{ p.content|linebreaks|truncatewords:10 }}
                {% endautoescape %}
              </div>
            </div>
            <a href="{% url 'product_detail' p.slug %}" class="btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block navigation %}
{% if page_obj.has_other_pages %}
<nav class="list-pages">
    <ul>
		{% if page_obj.has_previous %}
		<li class="page-num">
			<a href="?page={{ page_obj.previous_page_number }}">&lt;</a>
		</li>
		{% endif %}

        {% for p in paginator.page_range %}
		{% if page_obj.number == p %}
		<li class="page-num page-num-selected">{{ p }}</li>
		{% elif p >= page_obj.number|add:-2 and p <= page_obj.number|add:2 %}
        <li class="page-num">
            <a href="?page={{ p }}">{{ p }}</a>
        </li>
		{% endif %}
        {% endfor %}

		{% if page_obj.has_next %}
		<li class="page-num">
			<a href="?page={{ page_obj.next_page_number }}">&gt;</a>
		</li>
		{% endif %}

    </ul>
</nav>
{% endif %}
{% endblock %}