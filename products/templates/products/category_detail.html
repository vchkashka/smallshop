{% extends 'base.html' %}
{% load static %}

{% block content %}
{% if category.details %}
      {% if category.details.banner_image %}
      <div class="banner" style="background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('{% static 'core/images/' %}{{ category.details.banner_image }}');">
               {% if category.details.description %}
                <div class="banner-content">
                  <h1>–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞: {{category.name}}</h1>
                  <p>{{ category.details.description }}</p>
                </div>
              {% endif %}
          </div>
      {% endif %}
    {% endif %}

<div class="container">

    {% if products %}
    <div class="grid">
        {% for p in products %}
        <div class="card">
          <div class="image-container">
            <img src="{{ p.image.url }}" alt="{{ p.title }}">
            <form method="post" action="{% url 'add_to_favorites' p.slug %}">
              {% csrf_token %}
              {% if user.is_authenticated and perms.products.can_mark_featured_product%}
                {% if user in p.favorites.all %}
                  <button type="submit" class="favorite-btn" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
                          formaction="{% url 'remove_from_favorites' p.slug %}">‚ù§Ô∏è</button>
                {% else %}
                  <button type="submit" class="favorite-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">ü§ç</button>
                {% endif %}
              {% endif %}
            </form>
          </div>
          <div class="card-body">
            <div class="card-content">
              <h5 class="card-title">{{ p.title }}</h5>
              <p class="product-price">{{ p.price }} ‚ÇΩ</p>
              <div class="card-text">
                {% autoescape off %}
                {{ p.content|linebreaks|truncatewords:10 }}
                {% endautoescape %}
              </div>
            </div>
            <a href="{% url 'product_detail' p.slug %}" class="btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
          </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</p>
    {% endif %}
</div>
{% endblock %}
