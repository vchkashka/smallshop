{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h3>
    {% if products %}
    <div class="grid">
        {% for p in products %}
        {% if p.is_published %}
        <div class="card">
          <div class="image-container">
            <img src="{{ p.image.url }}" alt="{{ p.title }}">
            <form method="post" action="{% url 'add_to_favorites' p.slug %}">
              {% csrf_token %}
              {% if user.is_authenticated and perms.products.can_mark_featured %}
                {% if user in p.favorites.all %}
                  <button type="submit" class="favorite-btn" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
                          formaction="{% url 'remove_from_favorites' p.slug %}">‚ù§Ô∏è</button>
                {% else %}
                  <button type="submit" class="favorite-btn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">ü§ç</button>
                {% endif %}
              {% endif %}
            </form>
          </div>
          <div class="card-body">
            <div class="card-content">
              <h5 class="card-title">{{ p.title }}</h5>
              <p class="product-price">{{ p.price }} ‚ÇΩ</p>
              <div class="card-text">
                {% autoescape off %}
                {{ p.content|linebreaks|truncatewords:10 }}
                {% endautoescape %}
              </div>
            </div>
            <a href="{% url 'product_detail' p.slug %}" class="btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
          </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
    {% endif %}
</div>
{% endblock %}